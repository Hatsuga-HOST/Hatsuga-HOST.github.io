<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoneyTracker - Kelola Keuangan Pribadi</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --danger: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary);
            color: white;
            padding: 1rem;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .auth-container, .dashboard {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: var(--secondary);
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .btn-danger:hover {
            background-color: #c1121f;
        }
        
        .hidden {
            display: none;
        }
        
        .transaction-form {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .transaction-form {
                grid-template-columns: 1fr;
            }
        }
        
        .transaction-list {
            margin-top: 20px;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .income {
            color: green;
        }
        
        .expense {
            color: red;
        }
        
        .summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .summary-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .balance {
            font-size: 24px;
            font-weight: bold;
        }
        
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            color: var(--dark);
        }
        
        .tab button:hover {
            background-color: #ddd;
        }
        
        .tab button.active {
            background-color: var(--primary);
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>MoneyTracker</h1>
            <p>Kelola keuangan pribadi dengan mudah</p>
        </header>
        
        <!-- Container untuk autentikasi -->
        <div id="authContainer" class="auth-container">
            <div class="tab">
                <button class="tablinks active" onclick="openTab(event, 'Login')">Login</button>
                <button class="tablinks" onclick="openTab(event, 'Register')">Daftar</button>
            </div>
            
            <div id="Login" class="tabcontent" style="display:block;">
                <h2>Login</h2>
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" placeholder="Masukkan email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Masukkan password">
                </div>
                <button onclick="login()">Login</button>
                <p id="loginMessage"></p>
            </div>
            
            <div id="Register" class="tabcontent" style="display:none;">
                <h2>Daftar Akun Baru</h2>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" placeholder="Masukkan email">
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" placeholder="Buat password (min. 6 karakter)">
                </div>
                <button onclick="register()">Daftar</button>
                <p id="registerMessage"></p>
            </div>
        </div>
        
        <!-- Dashboard setelah login -->
        <div id="dashboard" class="dashboard hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Dashboard Keuangan</h2>
                <button onclick="logout()" class="btn-danger">Logout</button>
            </div>
            
            <div class="summary">
                <div class="summary-card">
                    <h3>Saldo</h3>
                    <p class="balance" id="balanceAmount">Rp 0</p>
                </div>
                <div class="summary-card">
                    <h3>Pemasukan</h3>
                    <p class="income" id="incomeAmount">Rp 0</p>
                </div>
                <div class="summary-card">
                    <h3>Pengeluaran</h3>
                    <p class="expense" id="expenseAmount">Rp 0</p>
                </div>
            </div>
            
            <h3>Tambah Transaksi</h3>
            <div class="transaction-form">
                <div class="form-group">
                    <input type="text" id="transactionDescription" placeholder="Keterangan">
                </div>
                <div class="form-group">
                    <input type="number" id="transactionAmount" placeholder="Jumlah">
                </div>
                <div class="form-group">
                    <select id="transactionType">
                        <option value="income">Pemasukan</option>
                        <option value="expense">Pengeluaran</option>
                    </select>
                </div>
                <button onclick="addTransaction()">Tambah</button>
            </div>
            
            <h3>Riwayat Transaksi</h3>
            <div class="transaction-list" id="transactionList">
                <!-- Daftar transaksi akan dimuat di sini -->
            </div>
        </div>
    </div>

    <script>
        // Konfigurasi Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCFdcQFSLPyAt9zqOBSjgYO8IQOibKYKA8",
            authDomain: "finance-34ce0.firebaseapp.com",
            projectId: "finance-34ce0",
            storageBucket: "finance-34ce0.firebasestorage.app",
            messagingSenderId: "103206908021",
            appId: "1:103206908021:web:f25749c6fe42fc330b883c"
        };
        
        // Inisialisasi Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Referensi elemen DOM
        const authContainer = document.getElementById('authContainer');
        const dashboard = document.getElementById('dashboard');
        const loginMessage = document.getElementById('loginMessage');
        const registerMessage = document.getElementById('registerMessage');
        const balanceAmount = document.getElementById('balanceAmount');
        const incomeAmount = document.getElementById('incomeAmount');
        const expenseAmount = document.getElementById('expenseAmount');
        const transactionList = document.getElementById('transactionList');
        
        // Fungsi untuk tab
        function openTab(evt, tabName) {
            const tabcontent = document.getElementsByClassName("tabcontent");
            for (let i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            
            const tablinks = document.getElementsByClassName("tablinks");
            for (let i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }
        
        // Daftar pengguna baru
        function register() {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            if (password.length < 6) {
                registerMessage.textContent = "Password minimal 6 karakter";
                registerMessage.style.color = "red";
                return;
            }
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    registerMessage.textContent = "Pendaftaran berhasil! Silakan login.";
                    registerMessage.style.color = "green";
                    document.getElementById('registerEmail').value = "";
                    document.getElementById('registerPassword').value = "";
                    openTab(event, 'Login');
                })
                .catch((error) => {
                    registerMessage.textContent = "Error: " + error.message;
                    registerMessage.style.color = "red";
                });
        }
        
        // Login pengguna
        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Login berhasil
                    loginMessage.textContent = "";
                    loadUserData();
                })
                .catch((error) => {
                    loginMessage.textContent = "Error: " + error.message;
                    loginMessage.style.color = "red";
                });
        }
        
        // Logout
        function logout() {
            auth.signOut().then(() => {
                authContainer.classList.remove('hidden');
                dashboard.classList.add('hidden');
            });
        }
        
        // Tambah transaksi
        function addTransaction() {
            const description = document.getElementById('transactionDescription').value;
            const amount = parseFloat(document.getElementById('transactionAmount').value);
            const type = document.getElementById('transactionType').value;
            
            if (!description || !amount) {
                alert("Harap isi semua field");
                return;
            }
            
            const user = auth.currentUser;
            if (user) {
                db.collection("transactions").add({
                    userId: user.uid,
                    description: description,
                    amount: amount,
                    type: type,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                })
                .then(() => {
                    document.getElementById('transactionDescription').value = "";
                    document.getElementById('transactionAmount').value = "";
                })
                .catch((error) => {
                    console.error("Error adding transaction: ", error);
                });
            }
        }
        
        // Muat data pengguna
        function loadUserData() {
            const user = auth.currentUser;
            if (user) {
                authContainer.classList.add('hidden');
                dashboard.classList.remove('hidden');
                
                // Daftar transaksi
                db.collection("transactions")
                    .where("userId", "==", user.uid)
                    .orderBy("createdAt", "desc")
                    .onSnapshot((querySnapshot) => {
                        let totalIncome = 0;
                        let totalExpense = 0;
                        transactionList.innerHTML = "";
                        
                        querySnapshot.forEach((doc) => {
                            const transaction = doc.data();
                            const transactionElement = document.createElement('div');
                            transactionElement.className = 'transaction-item';
                            
                            if (transaction.type === 'income') {
                                totalIncome += transaction.amount;
                                transactionElement.innerHTML = `
                                    <div>${transaction.description}</div>
                                    <div class="income">+ Rp ${transaction.amount.toLocaleString()}</div>
                                    <button onclick="deleteTransaction('${doc.id}')" class="btn-danger">Hapus</button>
                                `;
                            } else {
                                totalExpense += transaction.amount;
                                transactionElement.innerHTML = `
                                    <div>${transaction.description}</div>
                                    <div class="expense">- Rp ${transaction.amount.toLocaleString()}</div>
                                    <button onclick="deleteTransaction('${doc.id}')" class="btn-danger">Hapus</button>
                                `;
                            }
                            
                            transactionList.appendChild(transactionElement);
                        });
                        
                        const balance = totalIncome - totalExpense;
                        balanceAmount.textContent = `Rp ${balance.toLocaleString()}`;
                        incomeAmount.textContent = `Rp ${totalIncome.toLocaleString()}`;
                        expenseAmount.textContent = `Rp ${totalExpense.toLocaleString()}`;
                        
                        // Warna saldo berdasarkan nilai
                        balanceAmount.style.color = balance >= 0 ? 'green' : 'red';
                    });
            }
        }
        
        // Hapus transaksi
        function deleteTransaction(id) {
            if (confirm("Apakah Anda yakin ingin menghapus transaksi ini?")) {
                db.collection("transactions").doc(id).delete()
                    .catch((error) => {
                        console.error("Error deleting transaction: ", error);
                    });
            }
        }
        
        // Deteksi status auth
        auth.onAuthStateChanged((user) => {
            if (user) {
                loadUserData();
            } else {
                authContainer.classList.remove('hidden');
                dashboard.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
